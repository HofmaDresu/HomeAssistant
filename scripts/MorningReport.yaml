alias: Morning Report
mode: restart
sequence:
  - action: todo.get_items
    metadata: {}
    data:
      status: needs_action
    response_variable: chore_list
    target:
      entity_id: todo.chores
  - action: weather.get_forecasts
    metadata: {}
    data:
      type: daily
    target:
      device_id: 9bdacd0d05f68f09cc87f284a7e4811c
    response_variable: weather
  - action: calendar.get_events
    metadata: {}
    data:
      duration:
        hours: 24
        minutes: 0
        seconds: 0
      start_date_time: "{{ today_at().strftime('%Y-%m-%d %H:%M') }}"
    target:
      entity_id: calendar.hofma_dresu
    response_variable: events
  - variables:
      question: >
        *Time of day*  {%- if now().hour < 12 %}
          morning
        {% elif now().hour < 16 %}
          afternoon
        {% elif now().hour < 20 %}
          evening
        {% else %}
          night
        {%- endif %}

        *Weather*
          High: {{weather['weather.openweathermap'].forecast[0].temperature}} F
        Low: {{weather['weather.openweathermap'].forecast[0].templow}} F

        Condition: {{weather['weather.openweathermap'].forecast[0].condition}}

        Precipitation:
        {{weather['weather.openweathermap'].forecast[0].precipitation}}

        Precipitation Chance:
        {{weather['weather.openweathermap'].forecast[0].precipitation_probability}}

        *Calendar* {{'\n'}} {% for ev in events['calendar.hofma_dresu'].events
        -%}
          {{ev.summary}} {%- if 'T' in ev.start %} at {{':'.join(ev.start.split('T')[1].split('-')[0].split(':', 2)[:2])}}{% endif -%}
          {{'\n'}}
        {%- endfor %}

        {% set chorelist_items = chore_list['todo.chores']['items'] | list %} 

        {% set should_show_chores = chorelist_items | count > 0 %}

        {% set today_is_mow_day = states.binary_sensor.today_is_mow_day.state ==
        'on' %}

        {% set company_mode = states.input_boolean.company_mode.state == 'on' %}
        {%- if not company_mode %}
          {%- if now().weekday() == 1 or should_show_chores or today_is_mow_day %}
            *Chores*
            {{'\n'}}
            {%- if now().weekday() == 1 %}
              {%- if states.input_boolean.recycling_at_next_trash.state == "on" %}
                take out trash, recycling, and yard waste
              {% else %}
                take out trash
              {% endif -%}
            {% endif -%}
            {%- if today_is_mow_day %}
              pick up sticks in lawn
            {% endif -%}
            {%- if should_show_chores %}
              {% for chore in chorelist_items -%}
                {{chore.summary}}
                {{'\n'}}
              {%- endfor %}
            {% endif -%}
          {% endif -%}
        {% endif -%}
  - stop: testing
    enabled: false
  - action: openai_conversation.generate_content
    metadata: {}
    data:
      config_entry: 01KE4R5M3S9151PZCY4TZ06581
      prompt: >-
        - You are a radio reporter from the 1920s

        - You state times in 24 hour format

        - You state temperatures in fahrenheit

        - You use old-timey coloquialisms

        - You summarize the following information in the style of a radio news
        report



        {{question}}
    response_variable: message
  - alias: TTS Speak
    if:
      - condition: template
        value_template: >-
          {{ message.text.split(' ') | length <
          states.sensor.eleven_labs_remaining_character_count.state  | int}}
    then:
      - action: tts.speak
        metadata: {}
        data:
          cache: true
          media_player_entity_id: media_player.home_assistant_voice_091b0c_media_player
          message: "{{ message.text }}"
          options:
            voice: ttLooivY93OUNiBcvW5R
        target:
          entity_id: tts.elevenlabs
        enabled: true
    else:
      - action: tts.speak
        metadata: {}
        data:
          cache: true
          media_player_entity_id: media_player.home_assistant_voice_091b0c_media_player
          message: "{{ message.text }}"
        target:
          entity_id: tts.home_assistant_cloud
        enabled: true
description: ""
icon: mdi:radio-tower
